"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(o,t,n){return t&&e(o.prototype,t),n&&e(o,n),o}}(),ExposureFeed=function(){function e(){_classCallCheck(this,e);var o=this;$('[data-action="open-stop-emails-modal"]').on("click",function(e){e.preventDefault();new ExposureConfirmModal($(this),"#confirm-unsub-all-emails",{title:"Turn off new story emails?",description:"Are you sure? You will no longer get emails when Exposure members post new stories. (You can always turn them on again later.)",yesLabel:"Yes, unsubscribe from all",noLabel:"No, nevermind"},function(){Exposure.simplePost("/feed/turn-off-emails")},function(){}).show();return!1}),$('[data-action="feed-toggle-follow"]').on("click",function(e){o.toggleRelationship(e.target.id,$(this))}),$('[data-action="feed-toggle-emailsub"]').on("click",function(e){o.toggleRelationship(e.target.id,$(this))});var t=$("#feed-stories-container");if(t.length){this._loadingMore=!1,this.enableEndlessScroll=window.$enableEndlessScroll,this.$storiesEl=$("#feed-stories-container");try{var n=+window.location.search.match(/page=(\d+)/)[1]}catch(i){var n=1}this.currentPage=n,1!=n&&(this.enableEndlessScroll=!1),$(window).scroll(debounce(function(){o.loadMoreIfAble()}))}}return _createClass(e,[{key:"loadMoreIfAble",value:function(){this.closeToBottomOfStories()&&this.loadMore()}},{key:"closeToBottomOfStories",value:function(){var e=this.$storiesEl.offset().top+this.$storiesEl.height(),o=$(window).scrollTop()+1200;return o>=e}},{key:"loadMore",value:function(){if(!this._loadingMore&&this.enableEndlessScroll){var e=this,o=this.currentPage+1;$(".loading-more-stories-indicator").fadeIn(300),this._loadingMore=!0,$(".member-site-pagnation").hide(),$.get("?page="+o).done(function(t){var n=$(t).find("#feed-stories-container"),i=n.find(".story");if(i.length){n.attr("id","exlm_"+(new Date).getTime()),i.appendTo(e.$storiesEl),e.currentPage=o;var a=window.location.pathname+"?page="+e.currentPage;"undefined"!=typeof ga&&ga("send","pageview",a),"undefined"!=typeof _gs&&_gs("track",a)}else e.enableEndlessScroll=!1,e.currentPage>1&&$(".end-of-stories-indicator").fadeIn(300)}).error(function(){}).always(function(){$(".loading-more-stories-indicator").fadeOut(300),e._loadingMore=!1})}}},{key:"toggleRelationship",value:function(e,o){var t=e.split("-")[0],n=e.split("-")[1];Exposure.loading(!0),$.post("/feed/subscriptions/toggle/"+n+"/"+t+"/"+o.is(":checked")).always(function(){Exposure.loading(!1)}).done(function(){Exposure.showMessage(n.capitalizeFirstLetter()+" subscription updated.")});var i=!0;$("#"+t+"-feed-toggle").is(":checked")&&(i=!1),$("#"+t+"-email-toggle").is(":checked")&&(i=!1),$("#sub-row-"+t).toggleClass("muted",i)}}]),e}();$("[data-is-feed]")&&$(window).ready(function(){window.$ExposureFeed=new ExposureFeed});